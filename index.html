<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Trade Journal</title>
  <style>
    :root {
      --bg: #121212;
      --sidebar-bg: #1e1e1e;
      --content-bg: #181818;
      --text: #e0e0e0;
      --muted: #888;
      --accent: #bb86fc;
      --border: #333;
      --hover: #2a2a2a;
      --trim-color: #aaccff;
      --win-color: #4caf50;
      --loss-color: #cf6679;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: sans-serif; background: var(--bg); color: var(--text); }
    .app { display: flex; height: 100vh; }
    .sidebar { width: 240px; background: var(--sidebar-bg); border-right: 1px solid var(--border); overflow-y: auto; }
    .sidebar h4 { margin: 12px 16px 4px; color: var(--accent); font-size: 0.9rem; }
    .sidebar ul { list-style: none; margin: 0; padding: 0; }
    .sidebar .sub, .sidebar .period { padding: 8px 12px; cursor: pointer; border-bottom: 1px solid var(--border); }
    .sidebar .sub.selected, .sidebar .period.selected { background: var(--hover); color: var(--accent); }
    .sidebar .sub:hover, .sidebar .period:hover { background: var(--hover); }
    .content { flex: 1; background: var(--content-bg); padding: 16px; overflow-y: auto; }
    .toolbar { display: flex; flex-wrap: wrap; align-items: center; gap: 8px; margin-bottom: 16px; }
    .toolbar label { color: var(--muted); font-size: 0.9rem; }
    .toolbar input, .toolbar select, .toolbar textarea, .toolbar button { padding: 6px 8px; background: var(--sidebar-bg); color: var(--text); border: 1px solid var(--border); border-radius: 4px; }
    .toolbar textarea { min-width: 200px; min-height: 40px; resize: vertical; }
    .toolbar button:hover { background: var(--hover); }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 8px; border: 1px solid var(--border); }
    th { background: var(--sidebar-bg); color: var(--accent); text-align: left; }
    tr:nth-child(even) { background: var(--content-bg); }
    .note-row td { background: var(--sidebar-bg); font-style: italic; color: var(--muted); }
    .action-btn { margin-right: 4px; }
  </style>
</head>
<body>
  <div class="app">
    <nav class="sidebar">
      <h4>Group By</h4>
      <ul id="periods"></ul>
      <h4>Sections</h4>
      <ul id="sections"></ul>
    </nav>
    <div class="content">
      <div class="toolbar">
        <label for="patternType">Section:</label>
        <select id="patternType"></select>
        <label for="entryDate">Date:</label>
        <input id="entryDate" type="date" />
        <label for="symbol">Symbol:</label>
        <input id="symbol" placeholder="e.g. AAPL" />
        <label for="avgPrice">Avg Price:</label>
        <input id="avgPrice" type="number" step="0.01" placeholder="opt." />
        <label for="shares">Shares:</label>
        <input id="shares" type="number" placeholder="opt." />
        <label for="stopPrice">Stop:</label>
        <input id="stopPrice" type="number" step="0.01" placeholder="opt." />
        <label for="notes">Notes:</label>
        <textarea id="notes" placeholder="Entry rationale (optional)"></textarea>
        <button onclick="logEntry()">Log Trade</button>
      </div>
      <div id="log"></div>
    </div>
  </div>
  <script>
    const sections = ['Flagging','Watch for Breakout','Current Positions','Wins','Losses'];
    let currentSection = null;
    let entries = [];
    let groupMode = 'month';
    let currentPeriod = null;

    const secList = document.getElementById('sections');
    const periodList = document.getElementById('periods');
    const dropdown = document.getElementById('patternType');

    function save() { localStorage.setItem('entries',JSON.stringify(entries)); }
    function load() { const d=localStorage.getItem('entries'); if(d) entries=JSON.parse(d); }

    function initSidebar() {
      // group toggles
      ['month','week'].forEach(m=>{
        const li=document.createElement('li'); li.className='period'; li.innerText=m==='month'? 'By Month':'By Week';
        li.addEventListener('click',()=>{
          groupMode=m; currentPeriod=null; updatePeriods(); selectPeriod();
        }); periodList.appendChild(li);
      });
      // sections
      sections.forEach(sec=>{
        const li=document.createElement('li'); li.className='sub'; li.innerText=sec;
        li.addEventListener('click',()=>{
          currentSection=sec; updateSections(); renderLog();
        }); secList.appendChild(li);
      });
      // dropdown
      sections.forEach(sec=>{
        const opt=document.createElement('option'); opt.value=sec; opt.innerText=sec; dropdown.appendChild(opt);
      });
      dropdown.addEventListener('change',()=>{
        currentSection=dropdown.value; updateSections(); renderLog();
      });
    }

    function updateSections(){
      secList.querySelectorAll('.sub.selected').forEach(el=>el.classList.remove('selected'));
      secList.querySelector(`.sub:nth-child(${sections.indexOf(currentSection)+2})`)?.classList.add('selected');
      dropdown.value=currentSection||sections[0];
    }

    function updatePeriods(){
      periodList.querySelectorAll('.period.selected').forEach(el=>el.classList.remove('selected'));
      periodList.querySelectorAll('.period')[groupMode==='month'?0:1].classList.add('selected');
      // generate period items
      // clear old
      Array.from(periodList.querySelectorAll('.period-item')).forEach(n=>n.remove());
      const keys = new Set(entries.map(e=>{
        const dt=new Date(e.date);
        if(groupMode==='month') return dt.toLocaleString('default',{month:'long',year:'numeric'});
        // week: compute Monday start
        const d=dt; const day=d.getDay(); const diff=d.getDate()-(day||7)+1; const wkstart=new Date(d.setDate(diff));
        return 'Week of '+wkstart.toLocaleDateString();
      }));
      Array.from(keys).sort().forEach(key=>{
        const li=document.createElement('li'); li.className='period period-item'; li.innerText=key;
        li.addEventListener('click',()=>{ currentPeriod=key; updatePeriods(); renderLog(); });
        periodList.appendChild(li);
      });
    }

    function selectPeriod(){
      updatePeriods();
      // auto-select first period item
      const items=periodList.querySelectorAll('.period-item');
      if(items.length>0){ currentPeriod=currentPeriod||items[0].innerText; items.forEach(i=>i.classList.toggle('selected',i.innerText===currentPeriod)); }
    }

    function logEntry(){ if(!currentSection) return alert('Pick section');
      const sym=document.getElementById('symbol').value.trim().toUpperCase(); if(!sym) return alert('Symbol');
      const avg=parseFloat(document.getElementById('avgPrice').value)||null;
      const shares=parseInt(document.getElementById('shares').value)||null;
      const stop=parseFloat(document.getElementById('stopPrice').value)||null;
      const notes=document.getElementById('notes').value.trim()||null;
      const dateInput=document.getElementById('entryDate').value;
      const dt=dateInput?new Date(dateInput):new Date();
      entries.unshift({ id:Date.now()+Math.random(), section:currentSection, sym, avg, shares, stop, notes, date:dt.toLocaleString(), dateKey:dt.toLocaleDateString()});
      save(); updatePeriods(); renderLog();
      ['symbol','avgPrice','shares','stopPrice','notes','entryDate'].forEach(id=>document.getElementById(id).value='');
    }

    function renderLog(){
      const log=document.getElementById('log'); log.innerHTML='';
      if(!currentSection||!currentPeriod){ log.textContent='Select module and period'; return; }
      // filter
      const list=entries.filter(e=>e.section===currentSection);
      const byPeriod=list.filter(e=>{
        const dt=new Date(e.date);
        if(groupMode==='month'){
          const key=dt.toLocaleString('default',{month:'long',year:'numeric'});
          return key===currentPeriod;
        } else {
          const d=dt; const day=d.getDay(); const diff=d.getDate()-(day||7)+1; const wk=new Date(d.setDate(diff));
          return 'Week of '+wk.toLocaleDateString()===currentPeriod;
        }
      });
      // table
      const table=document.createElement('table');
      const hdr = '<thead><tr><th>Date</th><th>Symbol</th><th>Avg</th><th>Shares</th><th>Stop</th><th>Trim</th><th>Actions</th></tr></thead>'; table.innerHTML=hdr;
      const body=document.createElement('tbody');
      byPeriod.forEach(e=>{
        const rr=e.avg!=null&&e.stop!=null?e.avg-e.stop:0;
        const t1=e.avg? (e.avg+rr*3).toFixed(2):'';
        const t2=e.avg? (e.avg+rr*5).toFixed(2):'';
        const trim=`${e.avg?Math.floor(e.shares*0.2):''}@${t1}, ${e.avg?Math.floor(e.shares*0.3):''}@${t2}`;
        const row=document.createElement('tr');
        row.innerHTML=`<td>${e.date}</td><td>${e.sym}</td><td>${e.avg||''}</td><td>${e.shares||''}</td><td>${e.stop||''}</td><td>${trim}</td>`;
        const actTd=document.createElement('td');
        sections.includes(e.section)&& actTd.appendChild(Object.assign(document.createElement('button'),{textContent:'Edit',className:'action-btn',onclick:()=>editEntry(e.id)}));
        actTd.appendChild(Object.assign(document.createElement('button'),{textContent:'Ã—',className:'action-btn',onclick:()=>removeEntry(e.id)}));
        row.appendChild(actTd);
        body.appendChild(row);
        if(e.notes){ const nr=document.createElement('tr'); nr.className='note-row'; nr.innerHTML=`<td colspan=7>${e.notes}</td>`; body.appendChild(nr);}      });
      table.appendChild(body); log.appendChild(table);
    }

    // stub edit/remove
    function editEntry(id){ alert('Edit '+id); }
    function removeEntry(id){ entries=entries.filter(e=>e.id!==id); save(); updatePeriods(); renderLog(); }

    // init
    document.addEventListener('DOMContentLoaded',()=>{ load(); initSidebar(); selectSectionAndPeriod(); });
    function selectSectionAndPeriod(){ currentSection=sections[0]; updateSections(); selectPeriod(); renderLog(); }
  </script>
</body>
</html>
